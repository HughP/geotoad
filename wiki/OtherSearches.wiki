#summary Other searches with GeoToad
#labels Featured

<wiki:toc max_depth="2">

= Using GeoToad for searches which are not built in =

_*Note:* Tested with Debian Linux and bash._

== "Proximity" search around an existing geocache ==

There has been a request for "proximity" searches:
Sometimes, you plan to attend an event, or want to visit one of the
"geocaching legends" as "${my_country}'s First", and you don't want
to miss the little D1/T1 traditional around the corner.

Here's a suggestion how to accomplish this (you will have to
add your credentials, and modify some other search parameters,
but you'll get the idea):

{{{
#!/bin/bash

CENTER=GC77       # or whatever should be the center of your search
DISTANCE=2km      # radius around $CENTER

# extract coordinates for $CENTER cache
geotoad -q wid -x list -o `pwd`/$CENTER.list $CENTER

# get coordinates from list
COORDS=`awk '{printf("%s,%s\n",$2,$3)}' $CENTER.list`

# now run the real query
geotoad -q coord -x gpx -o `pwd`/$CENTER-prox.gpx "$COORDS"
}}}

== Searches along a given track/route (issue 103) ==

{{{
#!/bin/bash

input=input.gpx # some file you picked up at e.g. openrouteservice.org

error=0.25k     # Douglas-Peucker tolerance
distance=1.25k  # interpolation distance
circle=1.00km   # search radius

# note: error/circle ~ 1/4, distance/circle ~ 5/4 will give you
# an approximate coverage of about 2/3 circle radius

# for a half-mile wide corridor along your route: 
#error=0.2m
#distance=1m
#circle=0.8mi

# simplify input with Douglas-Peucker,
# then interpolate for point distance,
# output as series of coordinates suited for geotoad

searchargs=$(
cat $input |
gpsbabel -i gpx -f - \
    -x simplify,crosstrack,error=$error \
         -o gpx -F - |
gpsbabel -i gpx -f - \
    -x interpolate,distance=$distance \
         -o csv -F - |
tr ',' ' ' |
awk '{printf("%.3f,%.3f|",$1,$2)}'

)

echo geotoad ... -y$circle -q coord \"$searchargs\"
}}}

Note the number of decimals in the "printf" command -
it will limit center point precision to about 100 metres
which should be sufficient in most cases.

The values for "error", "distance" and "circle" have to be adjusted by hand.
The ratio distance/circle obviously has to be smaller than 2 ;)

----

_(More to be added. Suggestions welcome.)_
